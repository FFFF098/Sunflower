# 前端 JavaScript 测试建议

**日期**: 2025-10-25  
**适用范围**: Day 5 播放器 JavaScript 功能

---

## 测试策略概述

### 为什么推荐手动测试？

前端 JavaScript 代码具有以下特点，使得手动测试更为实用：

1. **视觉效果验证** - 照片过渡动画、UI 交互需要人眼确认
2. **用户体验测试** - 播放流畅度、响应速度等主观感受
3. **浏览器环境依赖** - Canvas、Web Audio API 在真实浏览器中运行
4. **快速迭代** - MVP 阶段，手动测试更灵活高效

### 测试优先级

```
优先级 P0: 手动功能测试 ⭐⭐⭐⭐⭐
优先级 P1: 手动性能测试 ⭐⭐⭐⭐
优先级 P2: 浏览器兼容性测试 ⭐⭐⭐
优先级 P3: 自动化测试（可选） ⭐⭐
```

---

## 手动测试清单

### 1. 播放器核心功能测试

#### 测试环境准备
- [ ] 准备测试音频文件（MP3, 5-10分钟）
- [ ] 准备测试照片（10-20张，JPEG/PNG）
- [ ] 确保文件名包含时间戳格式：`YYYY-MM-DD-HH:MM:SS.jpg`

#### 播放控制测试

**TC-001: 项目加载**
- [ ] 上传音频和照片创建项目
- [ ] 验证项目出现在项目列表
- [ ] 点击打开项目
- [ ] 验证播放器视图加载成功
- [ ] 验证第一张照片正确显示
- [ ] 验证时间显示为 `00:00 / XX:XX`

**TC-002: 播放功能**
- [ ] 点击播放按钮
- [ ] 验证音频开始播放
- [ ] 验证播放按钮变为暂停图标
- [ ] 验证时间进度更新
- [ ] 验证时间轴进度条移动

**TC-003: 照片同步**
- [ ] 播放过程中观察照片切换
- [ ] 验证照片切换时机与时间戳对应
- [ ] 验证过渡动画流畅（无卡顿）
- [ ] 测试至少3次照片切换

**TC-004: 暂停/恢复**
- [ ] 播放中点击暂停
- [ ] 验证音频停止
- [ ] 验证当前照片保持显示
- [ ] 验证时间停止更新
- [ ] 点击播放恢复
- [ ] 验证从暂停位置继续

**TC-005: 停止功能**
- [ ] 播放中点击停止
- [ ] 验证音频停止
- [ ] 验证时间归零 `00:00`
- [ ] 验证显示第一张照片
- [ ] 验证进度条归零

**TC-006: 时间轴跳转**
- [ ] 点击时间轴不同位置（25%, 50%, 75%）
- [ ] 验证音频跳转到对应位置
- [ ] 验证照片切换到对应时间点
- [ ] 验证时间显示正确

**TC-007: 音量控制**
- [ ] 拖动音量滑块到 50%
- [ ] 验证音量降低
- [ ] 拖动到 0%
- [ ] 验证静音
- [ ] 拖动到 100%
- [ ] 验证恢复音量

**TC-008: 播放速率**
- [ ] 点击 0.5x 速率按钮
- [ ] 验证播放变慢
- [ ] 验证照片切换对应减慢
- [ ] 点击 1.5x 速率按钮
- [ ] 验证播放加快
- [ ] 恢复 1.0x 正常速率

#### 过渡动画测试

**TC-009: 淡入淡出效果**
- [ ] 在播放器选项中设置 `transitionType: 'fade'`
- [ ] 播放并观察照片切换
- [ ] 验证前一张照片淡出
- [ ] 验证新照片淡入
- [ ] 验证过渡流畅无闪烁

**TC-010: 滑动效果**
- [ ] 设置 `transitionType: 'slide'`
- [ ] 观察照片从右侧滑入
- [ ] 验证前一张照片向左滑出
- [ ] 验证动画流畅

**TC-011: 缩放效果**
- [ ] 设置 `transitionType: 'zoom'`
- [ ] 观察前一张照片缩小淡出
- [ ] 验证新照片放大淡入
- [ ] 验证缩放中心居中

---

### 2. 文件上传功能测试

**TC-012: 拖拽上传音频**
- [ ] 打开文件上传视图
- [ ] 拖拽一个 MP3 文件到音频上传区
- [ ] 验证上传进度显示
- [ ] 验证上传成功提示
- [ ] 验证文件出现在音频列表

**TC-013: 拖拽上传照片**
- [ ] 拖拽多张照片到照片上传区
- [ ] 验证批量上传进度
- [ ] 验证所有照片上传成功
- [ ] 验证文件列表更新

**TC-014: 点击上传**
- [ ] 点击音频上传区
- [ ] 选择文件
- [ ] 验证上传成功

**TC-015: 文件类型验证**
- [ ] 尝试上传 `.txt` 文件到音频区
- [ ] 验证显示错误提示
- [ ] 尝试上传 `.pdf` 到照片区
- [ ] 验证拒绝上传

**TC-016: 文件删除**
- [ ] 上传一个测试文件
- [ ] 点击删除按钮
- [ ] 确认删除对话框
- [ ] 验证文件从列表移除

---

### 3. 项目管理测试

**TC-017: 创建项目**
- [ ] 上传音频和照片
- [ ] 输入项目名称
- [ ] 点击创建项目
- [ ] 验证加载指示器显示
- [ ] 验证创建成功提示
- [ ] 验证项目列表刷新

**TC-018: 项目列表**
- [ ] 切换到项目管理视图
- [ ] 验证所有项目卡片显示
- [ ] 验证项目信息正确（名称、照片数、时长）
- [ ] 验证创建时间显示

**TC-019: 删除项目**
- [ ] 点击项目删除按钮
- [ ] 验证确认对话框出现
- [ ] 点击确认
- [ ] 验证项目从列表移除
- [ ] 验证删除成功提示

---

### 4. 视图切换测试

**TC-020: 导航切换**
- [ ] 点击"文件上传"导航
- [ ] 验证视图切换正确
- [ ] 验证导航高亮状态
- [ ] 依次测试所有导航项

**TC-021: 视图状态保持**
- [ ] 在上传视图上传文件
- [ ] 切换到其他视图
- [ ] 返回上传视图
- [ ] 验证文件列表保持

---

### 5. 错误处理测试

**TC-022: 网络错误**
- [ ] 断开网络连接
- [ ] 尝试上传文件
- [ ] 验证错误提示显示
- [ ] 恢复网络
- [ ] 验证功能恢复

**TC-023: 无效项目**
- [ ] 尝试加载不存在的项目
- [ ] 验证错误提示
- [ ] 验证应用不崩溃

**TC-024: 播放错误**
- [ ] 播放损坏的音频文件
- [ ] 验证错误提示
- [ ] 验证可以返回项目列表

---

## 性能测试

### 测试场景

**PT-001: 加载性能**
```
测试数据：
- 音频：10分钟 MP3
- 照片：50张，每张 2-5MB
- 浏览器：Chrome 最新版

测试步骤：
1. 清除浏览器缓存
2. 打开项目
3. 记录加载时间

验收标准：
- 总加载时间 < 3秒
- 第一张照片显示 < 1秒
```

**PT-002: 播放流畅度**
```
测试步骤：
1. 播放项目
2. 打开浏览器开发者工具 Performance 面板
3. 录制 30 秒播放
4. 分析帧率

验收标准：
- 平均帧率 >= 55fps
- 照片切换无明显卡顿
```

**PT-003: 内存稳定性**
```
测试步骤：
1. 打开浏览器开发者工具 Memory 面板
2. 记录初始内存
3. 完整播放项目 3 次
4. 记录结束内存

验收标准：
- 内存增长 < 50MB
- 无明显内存泄漏
```

**PT-004: 照片切换延迟**
```
测试步骤：
1. 在控制台运行性能测试代码
2. 记录每次照片切换时间

代码：
```javascript
let switchTimes = []
player.on('photochange', () => {
    const mark = performance.now()
    switchTimes.push(mark)
})

// 播放后查看
console.log('平均切换时间:', 
    switchTimes.reduce((a,b) => b-a) / switchTimes.length)
```

验收标准：
- 平均切换延迟 < 100ms
```

---

## 浏览器兼容性测试

### 测试矩阵

| 浏览器 | 版本 | 优先级 | 状态 |
|--------|------|--------|------|
| Chrome | 最新版 | P0 | [ ] |
| Firefox | 最新版 | P1 | [ ] |
| Safari | 最新版 | P1 | [ ] |
| Edge | 最新版 | P1 | [ ] |
| Chrome | 最新版-2 | P2 | [ ] |

### 兼容性测试清单

对每个浏览器执行：
- [ ] 基本播放功能
- [ ] 照片过渡动画
- [ ] 文件上传
- [ ] UI 显示正常
- [ ] 控制台无错误

---

## 自动化测试（可选）

如果团队决定添加自动化测试，推荐以下工具和方案：

### 工具选择

**Playwright（推荐）**
- 跨浏览器支持
- 可靠的异步处理
- 强大的调试能力

**安装**：
```bash
npm install -D @playwright/test
```

### 示例测试用例

```javascript
// tests/e2e/player.spec.js
import { test, expect } from '@playwright/test'

test.describe('LecturePlayer E2E Tests', () => {
    test.beforeEach(async ({ page }) => {
        await page.goto('http://localhost:5000')
    })
    
    test('should load and play project', async ({ page }) => {
        // 上传文件
        await page.setInputFiles('#audio-input', 'test-audio.mp3')
        await page.setInputFiles('#photos-input', [
            'test-photo-1.jpg',
            'test-photo-2.jpg'
        ])
        
        // 创建项目
        await page.fill('#project-title', 'Test Project')
        await page.click('#create-project-btn')
        
        // 等待加载
        await page.waitForSelector('.project-card')
        
        // 打开项目
        await page.click('.project-card button')
        
        // 验证播放器加载
        await expect(page.locator('#photo-canvas')).toBeVisible()
        
        // 点击播放
        await page.click('#play-btn')
        
        // 等待时间更新
        await page.waitForFunction(() => {
            const timeEl = document.querySelector('#current-time')
            return timeEl && timeEl.textContent !== '00:00'
        })
        
        // 验证播放中
        await expect(page.locator('.play-status')).toHaveClass(/playing/)
    })
    
    test('should switch photos during playback', async ({ page }) => {
        // 加载项目并播放
        // ...
        
        // 监听照片切换事件
        let photoChanges = 0
        await page.evaluate(() => {
            window.player.on('photochange', () => {
                window.photoChanges = (window.photoChanges || 0) + 1
            })
        })
        
        // 等待 10 秒
        await page.waitForTimeout(10000)
        
        // 验证至少切换了一次照片
        const changes = await page.evaluate(() => window.photoChanges)
        expect(changes).toBeGreaterThan(0)
    })
})
```

---

## 测试报告模板

### 测试执行记录

```markdown
# 前端测试执行报告

**测试日期**: YYYY-MM-DD  
**测试人员**: xxx  
**测试环境**: Chrome 120 / macOS 14

## 功能测试结果
